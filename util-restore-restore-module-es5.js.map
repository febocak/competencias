{"version":3,"sources":["src/app/util/restore/restore.component.html","src/app/util/restore/restore.component.ts","src/app/util/restore/restore.module.ts"],"names":[],"mappings":"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","sourcesContent":["export default \"<div class=\\\"row\\\">\\n  <div class=\\\"col-sm-12 col-md-8 col-lg-6 mx-auto\\\">\\n    <div class=\\\"card mt-3\\\">\\n      <div class=\\\"card-header\\\">\\n        Restaurar BD\\n      </div>\\n\\n      <div class=\\\"card-body\\\">\\n        <div class=\\\"row\\\" >\\n          <div class=\\\"col-9\\\">\\n\\n            <h5>Datos del archivo</h5>\\n            <table  class=\\\"table\\\">\\n              <tr>\\n                <th>Nombre: </th>\\n                <td colspan=\\\"3\\\" *ngIf=\\\"!!file\\\"> {{ file.name }} </td>\\n              </tr>\\n              <tr>\\n                <th>Fecha: </th>\\n                <td *ngIf=\\\"!!file\\\"> {{ fecha }} </td>\\n                <th>Hora: </th>\\n                <td *ngIf=\\\"!!file\\\"> {{ hora }} </td>\\n              </tr>\\n              \\n              <tr>\\n                <th>tipo: </th>\\n                <td *ngIf=\\\"!!file\\\"> {{ file.type }} </td>\\n                <th>tama√±o: </th>\\n                <td *ngIf=\\\"!!file\\\"> {{ file.size }} </td>\\n              </tr>\\n            </table>\\n          </div>\\n\\n          <div class=\\\"col-3\\\">\\n            <h5>Tablas</h5>\\n            <table class=\\\"table\\\">\\n              <ng-container *ngIf=\\\"!!tablas\\\"> \\n                <tr *ngFor=\\\"let tabla of tablas\\\">\\n                  <td class=\\\"p-1\\\"> {{ tabla }} </td>\\n                </tr>\\n              </ng-container>\\n            </table>\\n          </div>\\n        </div >\\n\\n        <label class=\\\"btn btn-primary btn-block btn-file\\\">\\n            <i class=\\\"fa fa-folder\\\"> </i> Seleccione el archivo \\n          <input #fileUrl type=\\\"file\\\" style=\\\"display: none;\\\" accept=\\\".json\\\" (change)=\\\"onChange($event)\\\">\\n        </label>\\n\\n        <div class=\\\"row\\\">\\n          <div class=\\\"col-6\\\">\\n            <button type=\\\"button\\\" class=\\\"btn btn-lg btn-primary btn-block\\\" [disabled]=\\\"!fileUrl.value\\\"\\n              (click)=\\\"onUpload()\\\">\\n              <i class=\\\"fa fa-upload\\\"></i> Restaurar BD\\n            </button>\\n          </div>\\n          <div class=\\\"col-6\\\">\\n            <button type=\\\"button\\\" class=\\\"btn btn-lg btn-secondary btn-block\\\" (click)=\\\"goBack()\\\">\\n              Cancelar\\n            </button>\\n          </div>\\n        </div>\\n      </div>\\n    </div>\\n  </div>\\n</div>\\n\"","import { Component, OnInit } from '@angular/core';\nimport { Location } from '@angular/common';\nimport { Router } from '@angular/router';\nimport { MessageService } from '@core/message/message.service';\nimport { CrudService } from '@services/crud.service';\n\n@Component({\n  selector: 'app-restore',\n  templateUrl: './restore.component.html',\n  styles: []\n})\nexport class RestoreComponent implements OnInit {\n  file;\n  fecha: string;\n  hora: string;\n  tablas: string[];\n  datos: Object;\n\n  constructor(private router: Router, \n              private location: Location,\n              private msg: MessageService,\n              private crudService: CrudService) {\n  }\n\n  ngOnInit() {\n  }\n\n  onChange(e) {\n    this.file = e.target.files[0];\n    let fecha = new Date(this.file.lastModified);\n    this.fecha = fecha.toLocaleDateString();\n    this.hora = fecha.toLocaleTimeString();\n\n    let reader  = new FileReader();\n    reader.onloadend =  () => {\n      this.datos = JSON.parse(reader.result as string);\n      this.tablas = Object.keys(this.datos)\n    }\n    reader.readAsText(this.file);\n  }\n\n  async onUpload() {\n    let numRecordsInDB = 0;\n    for (const tabla of this.tablas.filter(el => el !== 'users')) {\n      let verifyData = await this.verifyTabla(tabla);\n      let numRegistros = verifyData ? verifyData.length : 0; \n      numRecordsInDB += numRegistros;\n      console.log('tabla:', tabla, 'registros', numRegistros);\n      let datos = JSON.stringify(this.datos[tabla])\n    }\n    console.log('numRecordsInDB', numRecordsInDB)\n\n    if (numRecordsInDB === 0) {\n      this.tablas.forEach( async tabla => {\n        let datos = [...this.datos[tabla]];\n        console.log(tabla);\n        datos.forEach( record => {\n          this.crudService.setRecord$(tabla, record);\n        });\n      }); \n    }\n    \n    \n    this.router.navigate(['home']);\n    this.msg.ok('Datos restaurados satisfactoriamente');\n  }\n\n  goBack() {\n    this.location.back();\n  }\n\n  verifyTabla(tabla: string) {\n    return this.crudService.getAllRecords$(tabla).toPromise();\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { RestoreComponent } from './restore.component';\n\nconst routes: Routes = [\n  { path: '', component: RestoreComponent }\n];\n\n@NgModule({\n  declarations: [RestoreComponent],\n  imports: [\n    CommonModule, \n    RouterModule.forChild(routes)\n  ]\n})\nexport class RestoreModule { }\n"],"sourceRoot":"webpack:///"}