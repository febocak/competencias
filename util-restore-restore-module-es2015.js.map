{"version":3,"sources":["./src/app/util/restore/restore.component.html","./src/app/util/restore/restore.component.ts","./src/app/util/restore/restore.module.ts"],"names":[],"mappings":"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","file":"util-restore-restore-module-es2015.js","sourcesContent":["export default \"<div class=\\\"row\\\">\\n  <div class=\\\"col-sm-12 col-md-8 col-lg-6 mx-auto\\\">\\n    <div class=\\\"card mt-3\\\">\\n      <div class=\\\"card-header\\\">\\n        Restaurar BD\\n      </div>\\n\\n      <div class=\\\"card-body\\\">\\n        <div class=\\\"row\\\" >\\n          <div class=\\\"col-9\\\">\\n\\n            <h5>Datos del archivo</h5>\\n            <table  class=\\\"table\\\">\\n              <tr>\\n                <th>Nombre: </th>\\n                <td colspan=\\\"3\\\" *ngIf=\\\"!!file\\\"> {{ file.name }} </td>\\n              </tr>\\n              <tr>\\n                <th>Fecha: </th>\\n                <td *ngIf=\\\"!!file\\\"> {{ fecha }} </td>\\n                <th>Hora: </th>\\n                <td *ngIf=\\\"!!file\\\"> {{ hora }} </td>\\n              </tr>\\n              \\n              <tr>\\n                <th>tipo: </th>\\n                <td *ngIf=\\\"!!file\\\"> {{ file.type }} </td>\\n                <th>tama√±o: </th>\\n                <td *ngIf=\\\"!!file\\\"> {{ file.size }} </td>\\n              </tr>\\n            </table>\\n          </div>\\n\\n          <div class=\\\"col-3\\\">\\n            <h5>Tablas</h5>\\n            <table class=\\\"table\\\">\\n              <ng-container *ngIf=\\\"!!tablas\\\"> \\n                <tr *ngFor=\\\"let tabla of tablas\\\">\\n                  <td class=\\\"p-1\\\"> {{ tabla }} </td>\\n                </tr>\\n              </ng-container>\\n            </table>\\n          </div>\\n        </div >\\n\\n        <label class=\\\"btn btn-primary btn-block btn-file\\\">\\n            <i class=\\\"fa fa-folder\\\"> </i> Seleccione el archivo \\n          <input #fileUrl type=\\\"file\\\" style=\\\"display: none;\\\" accept=\\\".json\\\" (change)=\\\"onChange($event)\\\">\\n        </label>\\n\\n        <div class=\\\"row\\\">\\n          <div class=\\\"col-6\\\">\\n            <button type=\\\"button\\\" class=\\\"btn btn-lg btn-primary btn-block\\\" [disabled]=\\\"!fileUrl.value\\\"\\n              (click)=\\\"onUpload()\\\">\\n              <i class=\\\"fa fa-upload\\\"></i> Restaurar BD\\n            </button>\\n          </div>\\n          <div class=\\\"col-6\\\">\\n            <button type=\\\"button\\\" class=\\\"btn btn-lg btn-secondary btn-block\\\" (click)=\\\"goBack()\\\">\\n              Cancelar\\n            </button>\\n          </div>\\n        </div>\\n      </div>\\n    </div>\\n  </div>\\n</div>\\n\"","import { Component, OnInit } from '@angular/core';\nimport { Location } from '@angular/common';\nimport { Router } from '@angular/router';\nimport { MessageService } from '@core/message/message.service';\nimport { CrudService } from '@services/crud.service';\n\n@Component({\n  selector: 'app-restore',\n  templateUrl: './restore.component.html',\n  styles: []\n})\nexport class RestoreComponent implements OnInit {\n  file;\n  fecha: string;\n  hora: string;\n  tablas: string[];\n  datos: Object;\n\n  constructor(private router: Router, \n              private location: Location,\n              private msg: MessageService,\n              private crudService: CrudService) {\n  }\n\n  ngOnInit() {\n  }\n\n  onChange(e) {\n    this.file = e.target.files[0];\n    let fecha = new Date(this.file.lastModified);\n    this.fecha = fecha.toLocaleDateString();\n    this.hora = fecha.toLocaleTimeString();\n\n    let reader  = new FileReader();\n    reader.onloadend =  () => {\n      this.datos = JSON.parse(reader.result as string);\n      this.tablas = Object.keys(this.datos)\n    }\n    reader.readAsText(this.file);\n  }\n\n  async onUpload() {\n    let numRecordsInDB = 0;\n    for (const tabla of this.tablas.filter(el => el !== 'users')) {\n      let verifyData = await this.verifyTabla(tabla);\n      let numRegistros = verifyData ? verifyData.length : 0; \n      numRecordsInDB += numRegistros;\n      console.log('tabla:', tabla, 'registros', numRegistros);\n      let datos = JSON.stringify(this.datos[tabla])\n    }\n    console.log('numRecordsInDB', numRecordsInDB)\n\n    if (numRecordsInDB === 0) {\n      this.tablas.forEach( async tabla => {\n        let datos = [...this.datos[tabla]];\n        console.log(tabla);\n        datos.forEach( record => {\n          this.crudService.setRecord$(tabla, record);\n        });\n      }); \n    }\n    \n    \n    this.router.navigate(['home']);\n    this.msg.ok('Datos restaurados satisfactoriamente');\n  }\n\n  goBack() {\n    this.location.back();\n  }\n\n  verifyTabla(tabla: string) {\n    return this.crudService.getAllRecords$(tabla).toPromise();\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { RestoreComponent } from './restore.component';\n\nconst routes: Routes = [\n  { path: '', component: RestoreComponent }\n];\n\n@NgModule({\n  declarations: [RestoreComponent],\n  imports: [\n    CommonModule, \n    RouterModule.forChild(routes)\n  ]\n})\nexport class RestoreModule { }\n"],"sourceRoot":"webpack:///"}